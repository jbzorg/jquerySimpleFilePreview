/*!
 * jquery.simpleFilePreview v0.1.0 (https://github.com/jakerella/jquerySimpleFilePreview)
 * Copyright (c) 2012 Jordan Kasper
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
!function(e){"use strict";e.fn.simpleFilePreview=function(n){if(!this||!this.length)return this;if(n=n?n:{},n=e.extend({},e.simpleFilePreview.defaults,n),n.readOnly&&(n.radioName=null,n.radioCheckedItem=null),this.each(function(){l(e(this),n)}),e.simpleFilePreview.init)return this;var p=e("body");return e.simpleFilePreview.init=!0,p.on("click",".simpleFilePreview_input",function(i){e(this).closest(".simpleFilePreview").find("input.simpleFilePreview_formInput").trigger("click"),i.preventDefault()}),p.on("click",".simpleFilePreview input.simpleFilePreview_formInput",function(i){return e(this).val().length?(n.readOnly||e(this).closest(".simpleFilePreview").find(".simpleFilePreview_preview").trigger("click"),void i.preventDefault()):this}),p.on("change",".simpleFilePreview input.simpleFilePreview_formInput",function(i){if(!n.readOnly){if(n.ajaxUploadUrl){var l=new FormData,p=i.target.name.indexOf("[");p>-1?l.append(i.target.name.substr(0,p),i.target.files[0]):l.append(i.target.name,i.target.files[0]),e.ajax({url:n.ajaxUploadUrl,type:"POST",data:l,dataType:"json",contentType:!1,processData:!1,success:function(e){console.log("simpleFilePreview","success",e)},error:function(e){console.log("simpleFilePreview","error",e)}})}var a=e(this).closest(".simpleFilePreview");if(1==a.attr("data-sfpallowmultiple")&&!a.find(".simpleFilePreview_preview").length){var v=e.simpleFilePreview.uid++,m=a.clone(!0).attr("id","simpleFilePreview_"+v);m.find("input.simpleFilePreview_formInput").attr("id",m.find("input.simpleFilePreview_formInput").attr("id")+"_"+v).attr("name",function(e,i){var l=a.find("input.simpleFilePreview_formInput").attr("name"),t=parseInt(l.substring(l.indexOf("[")+1,l.indexOf("]")));return isNaN(t)?i:l.substring(0,l.indexOf("[")+1)+ ++t+l.substring(l.indexOf("]"))}).val(""),a.after(m);var o=a.closest(".simpleFilePreview_multi").width("+="+m.outerWidth(!0)).width();o>a.closest(".simpleFilePreview_multiClip").width()&&a.closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_shiftRight").trigger("click")}if(this.files&&this.files[0]){var d=new RegExp("^image/("+e.simpleFilePreview.previewFileTypes+")$");if(d.test(this.files[0].type.toLowerCase())&&window.FileReader){var w=new FileReader;w.onload=function(e){t(a,e.target.result,"",n)},w.readAsDataURL(this.files[0])}else{var f=this.files[0].type.toLowerCase().match(/^\s*[^\/]+\/([a-zA-Z0-9\-\.]+)\s*$/);f&&f[1]&&n.icons[f[1]]?t(a,n.icons[f[1]],r(this.value),n):t(a,n.defaultIcon,r(this.value),n)}return n.radioName&&a.find("input.simpleFilePreview_radio").val(a.context.files[0].name),this}var d=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$"),u=s(this.value);u=u?u.toLowerCase():null,u&&!/fakepath/.test(this.value.toLowerCase())&&d.test(i)?t(a,"file://"+this.value,"",n):n.icons[u]?t(a,n.icons[u],r(this.value),n):t(a,n.defaultIcon,r(this.value),n)}}),p.on("mouseover",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){if(!n.readOnly){var i=e(this).closest(".simpleFilePreview");i.find(".simpleFilePreview_preview").is(":visible")&&i.find(".simpleFilePreview_remove").show()}}),p.on("mouseout",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){e(this).closest(".simpleFilePreview").find(".simpleFilePreview_remove").hide()}),p.on("click",".simpleFilePreview_preview",function(){if(!n.readOnly){var l=e(this),t=l.closest(".simpleFilePreview");if(1==t.attr("data-sfpallowmultiple")&&t.siblings(".simpleFilePreview").length)return t.hasClass("simpleFilePreview_existing")&&t.parent().append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),i(l,n,1),t.closest(".simpleFilePreview_multi").width("-="+t.width()),t.remove(),this;t.hasClass("simpleFilePreview_existing")&&(t.find("input.simpleFilePreview_formInput").show(),t.append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),t.removeClass("simpleFilePreview_existing")),i(l,n,1);var r=t.find("input.simpleFilePreview_formInput").val("");if(r&&r.length&&r.val().length){for(var s=r.get(0).attributes,p="",a=0,v=s.length;v>a;++a)"value"!=s[a].name&&"title"!=s[a].name&&(p+=s[a].name+"='"+r.attr(s[a].name)+"' ");r.before('<input "'+p+'" />'),r.remove()}l.remove(),t.find(".simpleFilePreview_filename").remove(),t.find(".simpleFilePreview_remove").hide().end().find(".simpleFilePreview_input").show()}}),p.on("click",".simpleFilePreview_shiftRight",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"))+i.width();if(l>i.parent().width()){var t=i.find("li:first");i.animate({left:"-="+t.outerWidth(!0)})}}),p.on("click",".simpleFilePreview_shiftLeft",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"));if(0>l){var t=i.find("li:first").outerWidth(!0);i.animate({left:1>l+t?"+="+t:0})}}),this};var i=function(e,i,l){if(!i.limit)return!1;var t=e.closest(".simpleFilePreview_multi").find("> li");l=l?l:0,t.length>i.limit+l?t.last().hide():t.last().show()},l=function(i,l){var n=i.is("[multiple]");i=i.removeAttr("multiple").addClass("simpleFilePreview_formInput"),n||(l.radioName=null,l.radioCheckedItem=null);var p=e("<"+(n?"li":"div")+" id='simpleFilePreview_"+e.simpleFilePreview.uid++ +"' class='simpleFilePreview"+(l.radioName?" simpleFilePreview_withRadio":"")+"' data-sfpallowmultiple='"+(n?1:0)+"'><a class='simpleFilePreview_input'><span class='simpleFilePreview_inputButtonText'>"+l.buttonContent+"</span></a><span class='simpleFilePreview_remove'>"+l.removeContent+"</span>"+(l.radioName?"<input type='radio' class='simpleFilePreview_radio' name='"+l.radioName+"' value='empty' />":"")+"</"+(n?"li":"div")+">");i.before(p),p.append(i),l.readOnly&&p.hide(),i.css({width:p.width()+"px",height:p.height()-(l.radioName?20:0)+"px"}),n&&(p.wrap("<div class='simpleFilePreview_multiUI'><div class='simpleFilePreview_multiClip'><ul class='simpleFilePreview_multi"+(l.radioName?" simpleFilePreview_withRadio":"")+"'></ul></div></div>"),p.closest(".simpleFilePreview_multiUI").prepend("<span class='simpleFilePreview_shiftRight simpleFilePreview_shifter'>"+l.shiftRight+"</span>").append("<span class='simpleFilePreview_shiftLeft simpleFilePreview_shifter'>"+l.shiftLeft+"</span>"));var a=l.existingFiles;if(!a)return n&&e(".simpleFilePreview_multi").width(p.outerWidth(!0)*p.parent().find(".simpleFilePreview").length),i;var v=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$");if(n){var m=e.isArray(a)?1:0;for(var o in a){var d=e.simpleFilePreview.uid++,w=p.clone(!0).attr("id","simpleFilePreview_"+d);w.addClass("simpleFilePreview_existing").attr("data-sfprid",m?a[o]:o).find("input.simpleFilePreview_formInput").remove(),w.show(),p.before(w);var f=s(a[o]);f=f?f.toLowerCase():null,f&&v.test(f)?t(w,a[o],"",l):l.icons[f]?t(w,l.icons[f],r(a[o]),l):t(w,l.defaultIcon,r(a[o]),l),l.radioName&&w.find("input.simpleFilePreview_radio").val(w.attr("data-sfprid"))}return e(".simpleFilePreview_multi").width(p.outerWidth(!0)*p.parent().find(".simpleFilePreview").length),l.radioName&&p.closest(".simpleFilePreview_multi").find("input[type='radio'][value='"+l.radioCheckedItem+"']").prop("checked",!0),i}var u=null,m=e.isArray(a)?1:0;for(var o in a)u={id:m?a[o]:o,file:a[o]};if(!u)return i;p.attr("data-sfprid",u.id).addClass("simpleFilePreview_existing").find("input.simpleFilePreview_formInput").hide();var f=s(u.file);return f=f?f.toLowerCase():null,f&&v.test(f)?t(p,u.file,"",l):l.icons[f]?t(p,l.icons[f],r(u.file),l):t(p,l.defaultIcon,r(u.file),l),i},t=function(e,l,t,r){t=t?t:null,l=(new RegExp("[/\\\\]").test(l)?"":r.iconPath)+l,e.find(".simpleFilePreview_input").hide();var s=e.find(".simpleFilePreview_preview");if(s&&s.length?s.attr("src",l):(e.append("<img src='"+l+"' class='simpleFilePreview_preview "+(t?"simpleFilePreview_hasFilename":"")+"' alt='"+(t?t:"File Preview")+"' title='"+r.removeMessagePrefix+" "+(t?t:r.removeMessageStub)+"' />"),e.find("input.simpleFilePreview_formInput").attr("title",r.removeMessagePrefix+" "+(t?t:r.removeMessageStub))),i(e,r),!t)return null;var n=e.find(".simpleFilePreview_filename");n&&n.length?n.text(t):e.append("<span class='simpleFilePreview_filename'>"+t+"</span>").find(".simpleFilePreview_filename")},r=function(e){var i=e.match(/[\/\\]([^\/\\]+)$/);return i&&i[1]&&i[1].length?i[1]:null},s=function(e){var i=e.match(/[\.]([^\/\\\.]+)$/);return i&&i[1]&&i[1].length?i[1]:null};e.simpleFilePreview={defaults:{buttonContent:"Add File",removeContent:"X",existingFiles:null,shiftLeft:"&lt;&lt;",shiftRight:"&gt;&gt;",iconPath:"",defaultIcon:"preview_file.png",limit:0,removeMessagePrefix:"Remove",removeMessageStub:"this file",radioName:null,radioCheckedItem:null,readOnly:!1,ajaxUploadUrl:null,icons:{png:"preview_png.png",gif:"preview_png.png",bmp:"preview_png.png",svg:"preview_png.png",jpg:"preview_png.png",jpeg:"preview_png.png",pjpg:"preview_png.png",pjpeg:"preview_png.png",tif:"preview_png.png",tiff:"preview_png.png",mp3:"preview_mp3.png",mp4:"preview_mp3.png",wav:"preview_mp3.png",wma:"preview_mp3.png",pdf:"preview_pdf.png",txt:"preview_txt.png",rtf:"preview_txt.png",text:"preview_txt.png",plain:"preview_txt.png",zip:"preview_zip.png",tgz:"preview_zip.png","x-rar-compressed":"preview_zip.png","octet-stream":"preview_zip.png",odf:"preview_doc.png",odt:"preview_doc.png",doc:"preview_doc.png",msword:"preview_doc.png","vnd.openxmlformats-officedocument.wordprocessingml.document":"preview_doc.png",docx:"preview_doc.png",ods:"preview_xls.png","vnd.ms-excel":"preview_xls.png",xls:"preview_xls.png",xlx:"preview_xls.png",msexcel:"preview_xls.png","x-excel":"preview_xls.png","x-ms-excel":"preview_xls.png","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"preview_xls.png"}},uid:0,init:!1,previewFileTypes:"p?jpe?g|png|gif|bmp|svg"}}(jQuery);