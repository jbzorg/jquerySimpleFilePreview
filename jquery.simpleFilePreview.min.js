/*!
 * jquery.simpleFilePreview v0.1.0 (https://github.com/jakerella/jquerySimpleFilePreview)
 * Copyright (c) 2012-2015 Jordan Kasper, 2015 eusonlito, 2015 Alexei Ivashkevich
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
!function(e){"use strict";e.fn.simpleFilePreview=function(p){if(!this||!this.length)return this;p=p?p:{},p=e.extend({},e.simpleFilePreview.defaults,p),p.readOnly&&(p.radio=null),this.each(function(){l(e(this),p)});var n=e(this).closest(".simpleFilePreview_body");return n.on("click",".simpleFilePreview_input",function(i){e(this).closest(".simpleFilePreview").find("input.simpleFilePreview_formInput").trigger("click"),i.preventDefault()}),n.on("click",".simpleFilePreview input.simpleFilePreview_formInput",function(i){return e(this).val().length?(p.readOnly||e(this).closest(".simpleFilePreview").find(".simpleFilePreview_preview").trigger("click"),void i.preventDefault()):this}),n.on("change",".simpleFilePreview input.simpleFilePreview_formInput",function(i){if(!p.readOnly){if(p.ajaxUpload){var l=e(this),n=new FormData,a=i.target.name.indexOf("[");a>-1?n.append(i.target.name.substr(0,a),i.target.files[0]):n.append(i.target.name,i.target.files[0]),p.ajaxUpload.compose&&p.ajaxUpload.compose(n),p.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").show(),e.ajax({url:p.ajaxUpload.url,type:"POST",data:n,dataType:"json",contentType:!1,processData:!1,success:function(e,r,t){p.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").hide(),p.ajaxUpload.success&&p.ajaxUpload.success(e,r,t,i.target)},error:function(e,r,t){p.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").hide(),p.ajaxUpload.error&&p.ajaxUpload.error(e,r,t,i.target)},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&p.ajaxUpload.progressbar){var i=100*e.loaded/e.total,r=l.parent().find(".simpleFilePreview_progress div");r.css({width:i+"%"}).attr("aria-valuenow",i)}},!1),e}})}var v=e(this).closest(".simpleFilePreview");if(1==v.attr("data-sfpallowmultiple")&&!v.find(".simpleFilePreview_preview").length){var o=e.simpleFilePreview.uid++,m=v.clone(!0).attr("id","simpleFilePreview_"+o);p.ajaxUpload.progressbar&&m.find(".simpleFilePreview_progress").hide(),m.find("input.simpleFilePreview_formInput").attr("id",m.find("input.simpleFilePreview_formInput").attr("id")+"_"+o).attr("name",function(e,i){var l=v.find("input.simpleFilePreview_formInput").attr("name"),r=parseInt(l.substring(l.indexOf("[")+1,l.indexOf("]")));return isNaN(r)?i:l.substring(0,l.indexOf("[")+1)+ ++r+l.substring(l.indexOf("]"))}).val(""),v.after(m);var d=v.closest(".simpleFilePreview_multi").width("+="+m.outerWidth(!0)).width();d>v.closest(".simpleFilePreview_multiClip").width()&&v.closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_shiftRight").trigger("click")}if(this.files&&this.files[0]){var w=new RegExp("^image/("+e.simpleFilePreview.previewFileTypes+")$");if(w.test(this.files[0].type.toLowerCase())&&window.FileReader){var f=new FileReader;f.onload=function(e){r(v,e.target.result,"",p)},f.readAsDataURL(this.files[0])}else{var u=this.files[0].type.toLowerCase().match(/^\s*[^\/]+\/([a-zA-Z0-9\-\.]+)\s*$/);u&&u[1]&&p.icons[u[1]]?r(v,p.icons[u[1]],t(this.value),p):r(v,p.defaultIcon,t(this.value),p)}return p.radio&&v.find("input.simpleFilePreview_radio").val(v.context.files[0].name),this}var w=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$"),g=s(this.value);g=g?g.toLowerCase():null,g&&!/fakepath/.test(this.value.toLowerCase())&&w.test(i)?r(v,"file://"+this.value,"",p):p.icons[g]?r(v,p.icons[g],t(this.value),p):r(v,p.defaultIcon,t(this.value),p)}}),n.on("mouseover",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){if(!p.readOnly){var i=e(this).closest(".simpleFilePreview");i.find(".simpleFilePreview_preview").is(":visible")&&i.find(".simpleFilePreview_remove").show()}}),n.on("mouseout",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){e(this).closest(".simpleFilePreview").find(".simpleFilePreview_remove").hide()}),n.on("click",".simpleFilePreview_preview",function(){if(!p.readOnly){var l=e(this),r=l.closest(".simpleFilePreview");if(null!=p.beforeRemove&&p.beforeRemove(r),1==r.attr("data-sfpallowmultiple")&&r.siblings(".simpleFilePreview").length)return r.hasClass("simpleFilePreview_existing")&&r.parent().append("<input type='hidden' id='"+r.attr("id")+"_remove' name='removeFiles[]' value='"+r.attr("data-sfprid")+"' />"),i(l,p,1),r.closest(".simpleFilePreview_multi").width("-="+r.width()),r.remove(),this;r.hasClass("simpleFilePreview_existing")&&(r.find("input.simpleFilePreview_formInput").show(),r.append("<input type='hidden' id='"+r.attr("id")+"_remove' name='removeFiles[]' value='"+r.attr("data-sfprid")+"' />"),r.removeClass("simpleFilePreview_existing")),i(l,p,1);var t=r.find("input.simpleFilePreview_formInput").val("");if(t&&t.length&&t.val().length){for(var s=t.get(0).attributes,n="",a=0,v=s.length;v>a;++a)"value"!=s[a].name&&"title"!=s[a].name&&(n+=s[a].name+"='"+t.attr(s[a].name)+"' ");t.before('<input "'+n+'" />'),t.remove()}l.remove(),r.find(".simpleFilePreview_filename").remove(),r.find(".simpleFilePreview_remove").hide().end().find(".simpleFilePreview_input").show()}}),n.on("click",".simpleFilePreview_shiftRight",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"))+i.width();if(l>i.parent().width()){var r=i.find("li:first");i.animate({left:"-="+r.outerWidth(!0)})}}),n.on("click",".simpleFilePreview_shiftLeft",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"));if(0>l){var r=i.find("li:first").outerWidth(!0);i.animate({left:1>l+r?"+="+r:0})}}),this};var i=function(e,i,l){if(!i.limit)return!1;var r=e.closest(".simpleFilePreview_multi").find("> li");l=l?l:0,r.length>i.limit+l?r.last().hide():r.last().show()},l=function(i,l){var p=i.is("[multiple]");i=i.removeAttr("multiple").addClass("simpleFilePreview_formInput"),p||(l.radio=null);var n=e("<"+(p?"li":"div")+" id='simpleFilePreview_"+e.simpleFilePreview.uid++ +"' class='simpleFilePreview"+(l.radio?" simpleFilePreview_withRadio":"")+"' data-sfpallowmultiple='"+(p?1:0)+"'><a class='simpleFilePreview_input'><span class='simpleFilePreview_inputButtonText'>"+l.buttonContent+"</span></a><span class='simpleFilePreview_remove'>"+l.removeContent+"</span>"+(l.radio?"<input type='radio' class='simpleFilePreview_radio' name='"+l.radio.name+"' value='empty' />":"")+(l.ajaxUpload.progressbar?"<div class='progress simpleFilePreview_progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width:0%'></div></div>":"")+"</"+(p?"li":"div")+">");i.before(n),n.append(i),l.readOnly&&n.hide(),i.css({width:n.width()+"px",height:n.height()-(l.radio?20:0)+"px"}),p?(n.wrap("<div class='simpleFilePreview_multiUI simpleFilePreview_body'><div class='simpleFilePreview_multiClip'><ul class='simpleFilePreview_multi"+(l.radio?" simpleFilePreview_withRadio":"")+"'></ul></div></div>"),n.closest(".simpleFilePreview_multiUI").prepend("<span class='simpleFilePreview_shiftRight simpleFilePreview_shifter'>"+l.shiftRight+"</span>").append("<span class='simpleFilePreview_shiftLeft simpleFilePreview_shifter'>"+l.shiftLeft+"</span>")):n.wrap("<div class='simpleFilePreview_body'></div>");var a=l.existingFiles;if(!a)return p&&e(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),i;var v=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$");if(p){var o=e.isArray(a)?1:0;for(var m in a){var d=e.simpleFilePreview.uid++,w=n.clone(!0).attr("id","simpleFilePreview_"+d);w.addClass("simpleFilePreview_existing").attr("data-sfprid",o?a[m]:m).find("input.simpleFilePreview_formInput").remove(),w.show(),n.before(w);var f=s(a[m]);f=f?f.toLowerCase():null,f&&v.test(f)?r(w,a[m],"",l):l.icons[f]?r(w,l.icons[f],t(a[m]),l):r(w,l.defaultIcon,t(a[m]),l),l.radio&&w.find("input.simpleFilePreview_radio").val(w.attr("data-sfprid"))}return e(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),l.radio&&n.closest(".simpleFilePreview_multi").find("input[type='radio'][value='"+l.radio.checkedItem+"']").prop("checked",!0),i}var u=null,o=e.isArray(a)?1:0;for(var m in a)u={id:o?a[m]:m,file:a[m]};if(!u)return i;n.attr("data-sfprid",u.id).addClass("simpleFilePreview_existing").find("input.simpleFilePreview_formInput").hide();var f=s(u.file);return f=f?f.toLowerCase():null,f&&v.test(f)?r(n,u.file,"",l):l.icons[f]?r(n,l.icons[f],t(u.file),l):r(n,l.defaultIcon,t(u.file),l),i},r=function(e,l,r,t){r=r?r:null,l=(new RegExp("[/\\\\]").test(l)?"":t.iconPath)+l,e.find(".simpleFilePreview_input").hide();var s=e.find(".simpleFilePreview_preview");if(s&&s.length?s.attr("src",l):(e.append("<img src='"+l+"' class='simpleFilePreview_preview "+(r?"simpleFilePreview_hasFilename":"")+"' alt='"+(r?r:"File Preview")+"' title='"+t.removeMessage.prefix+" "+(r?r:t.removeMessage.stub)+"' />"),e.find("input.simpleFilePreview_formInput").attr("title",t.removeMessage.prefix+" "+(r?r:t.removeMessage.stub))),i(e,t),!r)return null;var p=e.find(".simpleFilePreview_filename");p&&p.length?p.text(r):e.append("<span class='simpleFilePreview_filename'>"+r+"</span>").find(".simpleFilePreview_filename")},t=function(e){var i=e.match(/[\/\\]([^\/\\]+)$/);return i&&i[1]&&i[1].length?i[1]:null},s=function(e){var i=e.match(/[\.]([^\/\\\.]+)$/);return i&&i[1]&&i[1].length?i[1]:null};e.simpleFilePreview={defaults:{buttonContent:"Add File",removeContent:"X",existingFiles:null,shiftLeft:"&lt;&lt;",shiftRight:"&gt;&gt;",iconPath:"",defaultIcon:"preview_file.png",limit:0,removeMessage:{prefix:"Remove",stub:"this file"},radio:null,readOnly:!1,ajaxUpload:null,beforeRemove:null,icons:{png:"preview_png.png",gif:"preview_png.png",bmp:"preview_png.png",svg:"preview_png.png",jpg:"preview_png.png",jpeg:"preview_png.png",pjpg:"preview_png.png",pjpeg:"preview_png.png",tif:"preview_png.png",tiff:"preview_png.png",mp3:"preview_mp3.png",mp4:"preview_mp3.png",wav:"preview_mp3.png",wma:"preview_mp3.png",pdf:"preview_pdf.png",txt:"preview_txt.png",rtf:"preview_txt.png",text:"preview_txt.png",plain:"preview_txt.png",zip:"preview_zip.png",tgz:"preview_zip.png","x-rar-compressed":"preview_zip.png","octet-stream":"preview_zip.png",odf:"preview_doc.png",odt:"preview_doc.png",doc:"preview_doc.png",msword:"preview_doc.png","vnd.openxmlformats-officedocument.wordprocessingml.document":"preview_doc.png",docx:"preview_doc.png",ods:"preview_xls.png","vnd.ms-excel":"preview_xls.png",xls:"preview_xls.png",xlx:"preview_xls.png",msexcel:"preview_xls.png","x-excel":"preview_xls.png","x-ms-excel":"preview_xls.png","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"preview_xls.png"}},uid:0,init:!1,previewFileTypes:"p?jpe?g|png|gif|bmp|svg"}}(jQuery);