/*!
 * jquery.simpleFilePreview v0.1.0 (https://github.com/jakerella/jquerySimpleFilePreview)
 * Copyright (c) 2012 Jordan Kasper
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
!function(e){"use strict";e.fn.simpleFilePreview=function(p){if(!this||!this.length)return this;p=p?p:{},p=e.extend({},e.simpleFilePreview.defaults,p),p.readOnly&&(p.radio=null),this.each(function(){l(e(this),p)});var n=e(this).closest(".simpleFilePreview_body");return n.on("click",".simpleFilePreview_input",function(i){e(this).closest(".simpleFilePreview").find("input.simpleFilePreview_formInput").trigger("click"),i.preventDefault()}),n.on("click",".simpleFilePreview input.simpleFilePreview_formInput",function(i){return e(this).val().length?(p.readOnly||e(this).closest(".simpleFilePreview").find(".simpleFilePreview_preview").trigger("click"),void i.preventDefault()):this}),n.on("change",".simpleFilePreview input.simpleFilePreview_formInput",function(i){if(!p.readOnly){if(p.ajaxUpload){var l=new FormData,n=i.target.name.indexOf("[");n>-1?l.append(i.target.name.substr(0,n),i.target.files[0]):l.append(i.target.name,i.target.files[0]),p.ajaxUpload.compose&&p.ajaxUpload.compose(l),e.ajax({url:p.ajaxUpload.url,type:"POST",data:l,dataType:"json",contentType:!1,processData:!1,success:function(e,l,t){p.ajaxUpload.success&&p.ajaxUpload.success(e,l,t,i.target)},error:function(e,l,t){p.ajaxUpload.error&&p.ajaxUpload.error(e,l,t,i.target)}})}var a=e(this).closest(".simpleFilePreview");if(1==a.attr("data-sfpallowmultiple")&&!a.find(".simpleFilePreview_preview").length){var v=e.simpleFilePreview.uid++,m=a.clone(!0).attr("id","simpleFilePreview_"+v);m.find("input.simpleFilePreview_formInput").attr("id",m.find("input.simpleFilePreview_formInput").attr("id")+"_"+v).attr("name",function(e,i){var l=a.find("input.simpleFilePreview_formInput").attr("name"),t=parseInt(l.substring(l.indexOf("[")+1,l.indexOf("]")));return isNaN(t)?i:l.substring(0,l.indexOf("[")+1)+ ++t+l.substring(l.indexOf("]"))}).val(""),a.after(m);var o=a.closest(".simpleFilePreview_multi").width("+="+m.outerWidth(!0)).width();o>a.closest(".simpleFilePreview_multiClip").width()&&a.closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_shiftRight").trigger("click")}if(this.files&&this.files[0]){var d=new RegExp("^image/("+e.simpleFilePreview.previewFileTypes+")$");if(d.test(this.files[0].type.toLowerCase())&&window.FileReader){var w=new FileReader;w.onload=function(e){t(a,e.target.result,"",p)},w.readAsDataURL(this.files[0])}else{var f=this.files[0].type.toLowerCase().match(/^\s*[^\/]+\/([a-zA-Z0-9\-\.]+)\s*$/);f&&f[1]&&p.icons[f[1]]?t(a,p.icons[f[1]],r(this.value),p):t(a,p.defaultIcon,r(this.value),p)}return p.radio&&a.find("input.simpleFilePreview_radio").val(a.context.files[0].name),this}var d=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$"),u=s(this.value);u=u?u.toLowerCase():null,u&&!/fakepath/.test(this.value.toLowerCase())&&d.test(i)?t(a,"file://"+this.value,"",p):p.icons[u]?t(a,p.icons[u],r(this.value),p):t(a,p.defaultIcon,r(this.value),p)}}),n.on("mouseover",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){if(!p.readOnly){var i=e(this).closest(".simpleFilePreview");i.find(".simpleFilePreview_preview").is(":visible")&&i.find(".simpleFilePreview_remove").show()}}),n.on("mouseout",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){e(this).closest(".simpleFilePreview").find(".simpleFilePreview_remove").hide()}),n.on("click",".simpleFilePreview_preview",function(){if(!p.readOnly){var l=e(this),t=l.closest(".simpleFilePreview");if(1==t.attr("data-sfpallowmultiple")&&t.siblings(".simpleFilePreview").length)return t.hasClass("simpleFilePreview_existing")&&t.parent().append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),i(l,p,1),t.closest(".simpleFilePreview_multi").width("-="+t.width()),t.remove(),this;t.hasClass("simpleFilePreview_existing")&&(t.find("input.simpleFilePreview_formInput").show(),t.append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),t.removeClass("simpleFilePreview_existing")),i(l,p,1);var r=t.find("input.simpleFilePreview_formInput").val("");if(r&&r.length&&r.val().length){for(var s=r.get(0).attributes,n="",a=0,v=s.length;v>a;++a)"value"!=s[a].name&&"title"!=s[a].name&&(n+=s[a].name+"='"+r.attr(s[a].name)+"' ");r.before('<input "'+n+'" />'),r.remove()}l.remove(),t.find(".simpleFilePreview_filename").remove(),t.find(".simpleFilePreview_remove").hide().end().find(".simpleFilePreview_input").show()}}),n.on("click",".simpleFilePreview_shiftRight",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"))+i.width();if(l>i.parent().width()){var t=i.find("li:first");i.animate({left:"-="+t.outerWidth(!0)})}}),n.on("click",".simpleFilePreview_shiftLeft",function(){var i=e(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),l=parseInt(i.css("left"));if(0>l){var t=i.find("li:first").outerWidth(!0);i.animate({left:1>l+t?"+="+t:0})}}),this};var i=function(e,i,l){if(!i.limit)return!1;var t=e.closest(".simpleFilePreview_multi").find("> li");l=l?l:0,t.length>i.limit+l?t.last().hide():t.last().show()},l=function(i,l){var p=i.is("[multiple]");i=i.removeAttr("multiple").addClass("simpleFilePreview_formInput"),p||(l.radio=null);var n=e("<"+(p?"li":"div")+" id='simpleFilePreview_"+e.simpleFilePreview.uid++ +"' class='simpleFilePreview"+(l.radio?" simpleFilePreview_withRadio":"")+"' data-sfpallowmultiple='"+(p?1:0)+"'><a class='simpleFilePreview_input'><span class='simpleFilePreview_inputButtonText'>"+l.buttonContent+"</span></a><span class='simpleFilePreview_remove'>"+l.removeContent+"</span>"+(l.radio?"<input type='radio' class='simpleFilePreview_radio' name='"+l.radio.name+"' value='empty' />":"")+"</"+(p?"li":"div")+">");i.before(n),n.append(i),l.readOnly&&n.hide(),i.css({width:n.width()+"px",height:n.height()-(l.radio?20:0)+"px"}),p?(n.wrap("<div class='simpleFilePreview_multiUI simpleFilePreview_body'><div class='simpleFilePreview_multiClip'><ul class='simpleFilePreview_multi"+(l.radio?" simpleFilePreview_withRadio":"")+"'></ul></div></div>"),n.closest(".simpleFilePreview_multiUI").prepend("<span class='simpleFilePreview_shiftRight simpleFilePreview_shifter'>"+l.shiftRight+"</span>").append("<span class='simpleFilePreview_shiftLeft simpleFilePreview_shifter'>"+l.shiftLeft+"</span>")):n.wrap("<div class='simpleFilePreview_body'></div>");var a=l.existingFiles;if(!a)return p&&e(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),i;var v=new RegExp("^("+e.simpleFilePreview.previewFileTypes+")$");if(p){var m=e.isArray(a)?1:0;for(var o in a){var d=e.simpleFilePreview.uid++,w=n.clone(!0).attr("id","simpleFilePreview_"+d);w.addClass("simpleFilePreview_existing").attr("data-sfprid",m?a[o]:o).find("input.simpleFilePreview_formInput").remove(),w.show(),n.before(w);var f=s(a[o]);f=f?f.toLowerCase():null,f&&v.test(f)?t(w,a[o],"",l):l.icons[f]?t(w,l.icons[f],r(a[o]),l):t(w,l.defaultIcon,r(a[o]),l),l.radio&&w.find("input.simpleFilePreview_radio").val(w.attr("data-sfprid"))}return e(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),l.radio&&n.closest(".simpleFilePreview_multi").find("input[type='radio'][value='"+l.radio.checkedItem+"']").prop("checked",!0),i}var u=null,m=e.isArray(a)?1:0;for(var o in a)u={id:m?a[o]:o,file:a[o]};if(!u)return i;n.attr("data-sfprid",u.id).addClass("simpleFilePreview_existing").find("input.simpleFilePreview_formInput").hide();var f=s(u.file);return f=f?f.toLowerCase():null,f&&v.test(f)?t(n,u.file,"",l):l.icons[f]?t(n,l.icons[f],r(u.file),l):t(n,l.defaultIcon,r(u.file),l),i},t=function(e,l,t,r){t=t?t:null,l=(new RegExp("[/\\\\]").test(l)?"":r.iconPath)+l,e.find(".simpleFilePreview_input").hide();var s=e.find(".simpleFilePreview_preview");if(s&&s.length?s.attr("src",l):(e.append("<img src='"+l+"' class='simpleFilePreview_preview "+(t?"simpleFilePreview_hasFilename":"")+"' alt='"+(t?t:"File Preview")+"' title='"+r.removeMessage.prefix+" "+(t?t:r.removeMessage.stub)+"' />"),e.find("input.simpleFilePreview_formInput").attr("title",r.removeMessage.prefix+" "+(t?t:r.removeMessage.stub))),i(e,r),!t)return null;var p=e.find(".simpleFilePreview_filename");p&&p.length?p.text(t):e.append("<span class='simpleFilePreview_filename'>"+t+"</span>").find(".simpleFilePreview_filename")},r=function(e){var i=e.match(/[\/\\]([^\/\\]+)$/);return i&&i[1]&&i[1].length?i[1]:null},s=function(e){var i=e.match(/[\.]([^\/\\\.]+)$/);return i&&i[1]&&i[1].length?i[1]:null};e.simpleFilePreview={defaults:{buttonContent:"Add File",removeContent:"X",existingFiles:null,shiftLeft:"&lt;&lt;",shiftRight:"&gt;&gt;",iconPath:"",defaultIcon:"preview_file.png",limit:0,removeMessage:{prefix:"Remove",stub:"this file"},radio:null,readOnly:!1,ajaxUpload:null,icons:{png:"preview_png.png",gif:"preview_png.png",bmp:"preview_png.png",svg:"preview_png.png",jpg:"preview_png.png",jpeg:"preview_png.png",pjpg:"preview_png.png",pjpeg:"preview_png.png",tif:"preview_png.png",tiff:"preview_png.png",mp3:"preview_mp3.png",mp4:"preview_mp3.png",wav:"preview_mp3.png",wma:"preview_mp3.png",pdf:"preview_pdf.png",txt:"preview_txt.png",rtf:"preview_txt.png",text:"preview_txt.png",plain:"preview_txt.png",zip:"preview_zip.png",tgz:"preview_zip.png","x-rar-compressed":"preview_zip.png","octet-stream":"preview_zip.png",odf:"preview_doc.png",odt:"preview_doc.png",doc:"preview_doc.png",msword:"preview_doc.png","vnd.openxmlformats-officedocument.wordprocessingml.document":"preview_doc.png",docx:"preview_doc.png",ods:"preview_xls.png","vnd.ms-excel":"preview_xls.png",xls:"preview_xls.png",xlx:"preview_xls.png",msexcel:"preview_xls.png","x-excel":"preview_xls.png","x-ms-excel":"preview_xls.png","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"preview_xls.png"}},uid:0,init:!1,previewFileTypes:"p?jpe?g|png|gif|bmp|svg"}}(jQuery);