/*!
 * jquery.simpleFilePreview v0.1.0 (https://github.com/jakerella/jquerySimpleFilePreview)
 * Copyright (c) 2012-2015 Jordan Kasper, 2015 eusonlito, 2015 Alexei Ivashkevich
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
!function(i){"use strict";i.fn.simpleFilePreview=function(e){if(!this||!this.length)return this;if(e=e?e:{},e=i.extend({},i.simpleFilePreview.defaults,e),e.readOnly&&(e.radio=null),e.removeDialog&&(e.removeDialog.id||(e.removeDialog.id=i(this).id+"_remove_dialog"),e.removeDialog.title||(e.removeDialog.title="Remove"),e.removeDialog.text||(e.removeDialog.text="Are you sure?"),e.removeDialog.ok||(e.removeDialog.ok="Ok"),e.removeDialog.cancel||(e.removeDialog.cancel="Cancel"),i('<div id="'+e.removeDialog.id+'" title="'+e.removeDialog.title+'"><p><span class="ui-icon ui-icon-alert"></span>'+e.removeDialog.text+"</p></div>").dialog({autoOpen:!1,resizable:!1,modal:!0})),e.contextMenu){e.contextMenu.fileText||(e.contextMenu.fileText="Open file"),e.contextMenu.linkText||(e.contextMenu.linkText="Open link"),e.contextMenu.id||(e.contextMenu.id=i(this).id+"_openlink_dialog"),e.contextMenu.title||(e.contextMenu.title="Open link"),e.contextMenu.text||(e.contextMenu.text="Please enter link to file or image"),e.contextMenu.optionName||(e.contextMenu.optionName="Link"),e.contextMenu.ok||(e.contextMenu.ok="Ok"),e.contextMenu.cancel||(e.contextMenu.cancel="Cancel"),e.contextMenu.inputName||(e.contextMenu.inputName="input_openlink_dialog"),i('<div id="'+e.contextMenu.id+'" title="'+e.contextMenu.title+'"><p>'+e.contextMenu.text+'<form><fieldset><label for="'+e.contextMenu.id+'_link">'+e.contextMenu.optionName+'</label><input type="text" name="link" id="'+e.contextMenu.id+'_link" class="text ui-widget-content ui-corner-all"></fieldset></form></p></div>').dialog({autoOpen:!1,resizable:!1,modal:!0});var l=(e.parentSelector?e.parentSelector:"body")+" li:has(a.simpleFilePreview_input:visible)";context.init({preventDoubleContext:!1}),context.settings({compress:!0}),context.attach(l,[{text:e.contextMenu.fileText,action:function(){i(l).find(".simpleFilePreview_input").trigger("click")}},{text:e.contextMenu.linkText,action:function(i){a(i,e)}}])}this.each(function(){n(i(this),e)});var r=e.parentSelector?i(e.parentSelector+" .simpleFilePreview_body"):i(this).closest(".simpleFilePreview_body");return r.on("click",".simpleFilePreview_input",function(e){i(this).closest(".simpleFilePreview").find("input.simpleFilePreview_formInput").trigger("click"),e.preventDefault()}),r.on("click",".simpleFilePreview input.simpleFilePreview_formInput",function(t){return i(this).val().length?(e.readOnly||i(this).closest(".simpleFilePreview").find(".simpleFilePreview_preview").trigger("click"),void t.preventDefault()):this}),r.on("change",".simpleFilePreview input.simpleFilePreview_formInput",function(){o(e,i(this),"file")}),r.on("mouseover",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){if(!e.readOnly){var t=i(this).closest(".simpleFilePreview");t.find(".simpleFilePreview_preview").is(":visible")&&t.find(".simpleFilePreview_remove").show()}}),r.on("mouseout",".simpleFilePreview_preview, .simpleFilePreview input.simpleFilePreview_formInput",function(){i(this).closest(".simpleFilePreview").find(".simpleFilePreview_remove").hide()}),r.on("click",".simpleFilePreview_preview",function(){if(!e.readOnly){var l=i(this);if(e.removeDialog){var n=i("#"+e.removeDialog.id);n.dialog("option","buttons",[{text:e.removeDialog.ok,click:function(){t(l,e),i(this).dialog("close")}},{text:e.removeDialog.cancel,click:function(){i(this).dialog("close")}}]),n.dialog("open")}else t(l,e)}}),r.on("click",".simpleFilePreview_shiftRight",function(){var e=i(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),t=parseInt(e.css("left"))+e.width();if(t>e.parent().width()){var l=e.find("li:first");e.animate({left:"-="+l.outerWidth(!0)})}}),r.on("click",".simpleFilePreview_shiftLeft",function(){var e=i(this).closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_multi"),t=parseInt(e.css("left"));if(0>t){var l=e.find("li:first").outerWidth(!0);e.animate({left:1>t+l?"+="+l:0})}}),this};var t=function(e,i){var t=e.closest(".simpleFilePreview");if(null!=i.beforeRemove&&i.beforeRemove(t),1==t.attr("data-sfpallowmultiple")&&t.siblings(".simpleFilePreview").length)return t.hasClass("simpleFilePreview_existing")&&t.parent().append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),l(e,i,1),t.closest(".simpleFilePreview_multi").width("-="+t.width()),t.remove(),this;t.hasClass("simpleFilePreview_existing")&&(t.find("input.simpleFilePreview_formInput").show(),t.append("<input type='hidden' id='"+t.attr("id")+"_remove' name='removeFiles[]' value='"+t.attr("data-sfprid")+"' />"),t.removeClass("simpleFilePreview_existing")),l(e,i,1);var n=t.find("input.simpleFilePreview_formInput").val("");if(n&&n.length&&n.val().length){for(var r=n.get(0).attributes,s="",p=0,a=r.length;a>p;++p)"value"!=r[p].name&&"title"!=r[p].name&&(s+=r[p].name+"='"+n.attr(r[p].name)+"' ");n.before('<input "'+s+'" />'),n.remove()}e.remove(),t.find(".simpleFilePreview_filename").remove(),t.find(".simpleFilePreview_remove").hide().end().find(".simpleFilePreview_input").show()},l=function(e,i,t){if(!i.limit)return!1;var l=e.closest(".simpleFilePreview_multi").find("> li");t=t?t:0,l.length>i.limit+t?l.last().hide():l.last().show()},n=function(e,t){var l=e.is("[multiple]");e=e.removeAttr("multiple").addClass("simpleFilePreview_formInput"),l||(t.radio=null);var n=i("<"+(l?"li":"div")+" id='simpleFilePreview_"+i.simpleFilePreview.uid++ +"' class='simpleFilePreview"+(t.radio?" simpleFilePreview_withRadio":"")+"' data-sfpallowmultiple='"+(l?1:0)+"'><a class='simpleFilePreview_input'><span class='simpleFilePreview_inputButtonText'>"+t.buttonContent+"</span></a><span class='simpleFilePreview_remove'>"+t.removeContent+"</span>"+(t.radio?"<input type='radio' class='simpleFilePreview_radio' name='"+t.radio.name+"' value='empty' />":"")+(t.ajaxUpload.progressbar?"<div class='progress simpleFilePreview_progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100' style='width:0%'></div></div>":"")+(t.contextMenu?'<input type="hidden" name="'+t.contextMenu.inputName+"["+i.simpleFilePreview.linkid+']" />':"")+"</"+(l?"li":"div")+">");e.before(n),n.append(e),t.readOnly&&n.hide(),e.css({width:n.width()+"px",height:n.height()-(t.radio?20:0)+"px"}),l?(n.wrap("<div class='simpleFilePreview_multiUI simpleFilePreview_body'><div class='simpleFilePreview_multiClip'><ul class='simpleFilePreview_multi"+(t.radio?" simpleFilePreview_withRadio":"")+"'></ul></div></div>"),n.closest(".simpleFilePreview_multiUI").prepend("<span class='simpleFilePreview_shiftRight simpleFilePreview_shifter'>"+t.shiftRight+"</span>").append("<span class='simpleFilePreview_shiftLeft simpleFilePreview_shifter'>"+t.shiftLeft+"</span>")):n.wrap("<div class='simpleFilePreview_body'></div>");var a=t.existingFiles;if(!a)return l&&i(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),e;var o=new RegExp("^("+i.simpleFilePreview.previewFileTypes+")$");if(l){var v=i.isArray(a)?1:0;for(var m in a){var d=i.simpleFilePreview.uid++,u=n.clone(!0).attr("id","simpleFilePreview_"+d);t.contextMenu&&u.find('[name^="'+t.contextMenu.inputName+'"]').attr("name",t.contextMenu.inputName+"["+ ++i.simpleFilePreview.linkid+"]").val(""),u.addClass("simpleFilePreview_existing").attr("data-sfprid",v?a[m]:m).find("input.simpleFilePreview_formInput").remove(),u.show(),n.before(u);var c=p(a[m]);c=c?c.toLowerCase():null,c&&o.test(c)?r(u,a[m],"",t):t.icons[c]?r(u,t.icons[c],s(a[m]),t):r(u,t.defaultIcon,s(a[m]),t),t.radio&&u.find("input.simpleFilePreview_radio").val(u.attr("data-sfprid"))}return i(".simpleFilePreview_multi").width(n.outerWidth(!0)*n.parent().find(".simpleFilePreview").length),t.radio&&n.closest(".simpleFilePreview_multi").find("input[type='radio'][value='"+t.radio.checkedItem+"']").prop("checked",!0),e}var w=null,v=i.isArray(a)?1:0;for(var m in a)w={id:v?a[m]:m,file:a[m]};if(!w)return e;n.attr("data-sfprid",w.id).addClass("simpleFilePreview_existing").find("input.simpleFilePreview_formInput").hide();var c=p(w.file);return c=c?c.toLowerCase():null,c&&o.test(c)?r(n,w.file,"",t):t.icons[c]?r(n,t.icons[c],s(w.file),t):r(n,t.defaultIcon,s(w.file),t),e},r=function(e,i,t,n){t=t?t:null,i=new RegExp("^(http|https)://").test(i)?i:(new RegExp("[/\\\\]").test(i)?"":n.iconPath)+i,e.find(".simpleFilePreview_input").hide();var r=e.find(".simpleFilePreview_preview");if(r&&r.length?r.attr("src",i):(e.append("<img src='"+i+"' class='simpleFilePreview_preview "+(t?"simpleFilePreview_hasFilename":"")+"' alt='"+(t?t:"File Preview")+"' title='"+n.removeMessage.prefix+" "+(t?t:n.removeMessage.stub)+"' />"),e.find("input.simpleFilePreview_formInput").attr("title",n.removeMessage.prefix+" "+(t?t:n.removeMessage.stub))),l(e,n),!t)return null;var s=e.find(".simpleFilePreview_filename");s&&s.length?s.text(t):e.append("<span class='simpleFilePreview_filename'>"+t+"</span>").find(".simpleFilePreview_filename")},s=function(e){var i=e.match(/[\/\\]([^\/\\]+)$/);return i&&i[1]&&i[1].length?i[1]:null},p=function(e){var i=e.match(/[\.]([^\/\\\.]+)$/);return i&&i[1]&&i[1].length?i[1]:null},a=function(e,t){var l=i("#"+t.contextMenu.id);l.dialog("option","buttons",[{text:t.contextMenu.ok,click:function(){var e=i((t.parentSelector?t.parentSelector:"body")+' li:has(a.simpleFilePreview_input:visible) input[name^="'+t.contextMenu.inputName+'"]');e.val(i("#"+t.contextMenu.id+"_link").val()),o(t,e,"link"),i(this).dialog("close")}},{text:t.contextMenu.cancel,click:function(){i(this).dialog("close")}}]),l.dialog("open")},o=function(t,l,n){if(!t.readOnly){var a=l.get()[0];if(t.ajaxUpload){var o=new FormData,v=a.name.indexOf("["),m="file"==n?a.files[0]:"link"==n?l.val():"";v>-1?o.append(a.name.substr(0,v),m):o.append(a.name,m),t.ajaxUpload.compose&&t.ajaxUpload.compose(o),t.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").show(),i.ajax({url:t.ajaxUpload.url,type:"POST",data:o,dataType:"json",contentType:!1,processData:!1,success:function(e,i,n){t.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").hide(),t.ajaxUpload.success&&t.ajaxUpload.success(e,i,n,a)},error:function(e,i,n){t.ajaxUpload.progressbar&&l.parent().find(".simpleFilePreview_progress").hide(),t.ajaxUpload.error&&t.ajaxUpload.error(e,i,n,a)},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable&&t.ajaxUpload.progressbar){var i=100*e.loaded/e.total,n=l.parent().find(".simpleFilePreview_progress div");n.css({width:i+"%"}).attr("aria-valuenow",i)}},!1),e}})}var d=l.closest(".simpleFilePreview");if(1==d.attr("data-sfpallowmultiple")&&!d.find(".simpleFilePreview_preview").length){var u=i.simpleFilePreview.uid++,c=d.clone(!0).attr("id","simpleFilePreview_"+u);t.contextMenu&&c.find('[name^="'+t.contextMenu.inputName+'"]').attr("name",t.contextMenu.inputName+"["+ ++i.simpleFilePreview.linkid+"]").val(""),t.ajaxUpload.progressbar&&c.find(".simpleFilePreview_progress").hide(),c.find("input.simpleFilePreview_formInput").attr("id",c.find("input.simpleFilePreview_formInput").attr("id")+"_"+u).attr("name",function(e,i){var t=d.find("input.simpleFilePreview_formInput").attr("name"),l=parseInt(t.substring(t.indexOf("[")+1,t.indexOf("]")));return isNaN(l)?i:t.substring(0,t.indexOf("[")+1)+ ++l+t.substring(t.indexOf("]"))}).val(""),d.after(c);var w=d.closest(".simpleFilePreview_multi").width("+="+c.outerWidth(!0)).width();w>d.closest(".simpleFilePreview_multiClip").width()&&d.closest(".simpleFilePreview_multiUI").find(".simpleFilePreview_shiftRight").trigger("click")}var f=p(a.value);if(f=f?f.toLowerCase():null,"file"==n&&a.files&&a.files[0]){var g=new RegExp("^image/("+i.simpleFilePreview.previewFileTypes+")$");if(g.test(a.files[0].type.toLowerCase())&&window.FileReader){var x=new FileReader;x.onload=function(e){r(d,e.target.result,"",t)},x.readAsDataURL(a.files[0])}else{var _=a.files[0].type.toLowerCase().match(/^\s*[^\/]+\/([a-zA-Z0-9\-\.]+)\s*$/);_&&_[1]&&t.icons[_[1]]?r(d,t.icons[_[1]],s(a.value),t):r(d,t.defaultIcon,s(a.value),t)}return t.radio&&d.find("input.simpleFilePreview_radio").val(d.context.files[0].name),a}if("file"==n){var g=new RegExp("^("+i.simpleFilePreview.previewFileTypes+")$");f&&!/fakepath/.test(a.value.toLowerCase())&&g.test(e)?r(d,"file://"+a.value,"",t):t.icons[f]?r(d,t.icons[f],s(a.value),t):r(d,t.defaultIcon,s(a.value),t)}if("link"==n){var g=new RegExp("^("+i.simpleFilePreview.previewFileTypes+")$");g.test(f)?r(d,l.val(),"",t):r(d,t.icons[f]?t.icons[f]:t.defaultIcon,s(a.value),t)}}};i.simpleFilePreview={defaults:{buttonContent:"Add File",removeContent:"X",existingFiles:null,shiftLeft:"&lt;&lt;",shiftRight:"&gt;&gt;",iconPath:"",defaultIcon:"preview_file.png",limit:0,removeMessage:{prefix:"Remove",stub:"this file"},radio:null,readOnly:!1,ajaxUpload:null,beforeRemove:null,removeDialog:null,contextMenu:null,parentSelector:null,icons:{png:"preview_png.png",gif:"preview_png.png",bmp:"preview_png.png",svg:"preview_png.png",jpg:"preview_png.png",jpeg:"preview_png.png",pjpg:"preview_png.png",pjpeg:"preview_png.png",tif:"preview_png.png",tiff:"preview_png.png",mp3:"preview_mp3.png",mp4:"preview_mp3.png",wav:"preview_mp3.png",wma:"preview_mp3.png",pdf:"preview_pdf.png",txt:"preview_txt.png",rtf:"preview_txt.png",text:"preview_txt.png",plain:"preview_txt.png",zip:"preview_zip.png",tgz:"preview_zip.png","x-rar-compressed":"preview_zip.png","octet-stream":"preview_zip.png",odf:"preview_doc.png",odt:"preview_doc.png",doc:"preview_doc.png",msword:"preview_doc.png","vnd.openxmlformats-officedocument.wordprocessingml.document":"preview_doc.png",docx:"preview_doc.png",ods:"preview_xls.png","vnd.ms-excel":"preview_xls.png",xls:"preview_xls.png",xlx:"preview_xls.png",msexcel:"preview_xls.png","x-excel":"preview_xls.png","x-ms-excel":"preview_xls.png","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"preview_xls.png"}},uid:0,linkid:0,init:!1,previewFileTypes:"p?jpe?g|png|gif|bmp|svg"}}(jQuery);